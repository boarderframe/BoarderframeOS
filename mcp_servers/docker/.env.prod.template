# Production Environment Configuration for MCP Server Manager
# Security-hardened configuration template
# Copy this file to .env.prod and customize for your environment

# =============================================================================
# SECURITY WARNING: 
# - Change ALL default passwords and secrets before deployment
# - Use strong, randomly generated passwords (minimum 32 characters)
# - Store sensitive values in external secret management systems when possible
# - Regularly rotate all secrets and credentials
# =============================================================================

# Application Configuration
NODE_ENV=production
DEBUG_ENABLED=false
LOG_LEVEL=warn
PORT=8080

# Security Features
SECURITY_AUDIT_ENABLED=true
RATE_LIMIT_ENABLED=true
VULNERABILITY_SCANNING_ENABLED=true
SECURITY_HEADERS_ENABLED=true
TLS_REQUIRED=true

# Authentication & Authorization
JWT_SECRET=CHANGE_ME_RANDOM_256_BIT_SECRET_HERE
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=7d
SESSION_SECRET=CHANGE_ME_RANDOM_256_BIT_SECRET_HERE
BCRYPT_ROUNDS=12

# API Security
API_RATE_LIMIT_WINDOW=900000  # 15 minutes in ms
API_RATE_LIMIT_MAX=100        # requests per window
API_RATE_LIMIT_SKIP_SUCCESSFUL=false
API_TIMEOUT=30000             # 30 seconds

# Database Configuration (Redis)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_ME_STRONG_REDIS_PASSWORD_HERE
REDIS_DB=0
REDIS_TLS_ENABLED=false
REDIS_CONNECTION_TIMEOUT=5000
REDIS_COMMAND_TIMEOUT=3000
REDIS_MAX_RETRIES=3

# Database Security
DATABASE_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}
DATABASE_SSL_REJECT_UNAUTHORIZED=true
DATABASE_CONNECTION_LIMIT=20

# TLS/SSL Configuration
TLS_CERT_PATH=/etc/nginx/ssl/cert.pem
TLS_KEY_PATH=/etc/nginx/ssl/key.pem
TLS_CA_PATH=/etc/ssl/certs/ca-certificates.crt
TLS_MIN_VERSION=1.2
TLS_CIPHERS=ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384

# CORS Configuration
CORS_ORIGIN=https://your-domain.com,https://app.your-domain.com
CORS_CREDENTIALS=true
CORS_MAX_AGE=86400

# Content Security Policy
CSP_DEFAULT_SRC='self'
CSP_SCRIPT_SRC='self' 'unsafe-inline'
CSP_STYLE_SRC='self' 'unsafe-inline'
CSP_IMG_SRC='self' data: https:
CSP_CONNECT_SRC='self' wss: https:
CSP_FONT_SRC='self'
CSP_FRAME_ANCESTORS='none'

# Resource Limits
MCP_MANAGER_CPU_LIMIT=1.0
MCP_MANAGER_MEMORY_LIMIT=512M
MCP_MANAGER_CPU_RESERVATION=0.5
MCP_MANAGER_MEMORY_RESERVATION=256M

REDIS_CPU_LIMIT=0.5
REDIS_MEMORY_LIMIT=256M
REDIS_CPU_RESERVATION=0.25
REDIS_MEMORY_RESERVATION=128M

OLLAMA_CPU_LIMIT=2.0
OLLAMA_MEMORY_LIMIT=4G
OLLAMA_CPU_RESERVATION=1.0
OLLAMA_MEMORY_RESERVATION=2G

# Monitoring & Logging
PROMETHEUS_RETENTION_TIME=30d
PROMETHEUS_RETENTION_SIZE=10GB
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_STRONG_GRAFANA_PASSWORD_HERE
LOG_MAX_SIZE=100m
LOG_MAX_FILES=5

# Security Monitoring
FALCO_ENABLED=true
FALCO_RULES_FILE=/etc/falco/falco_rules.yaml
SECURITY_SCAN_INTERVAL=3600  # 1 hour in seconds
VULNERABILITY_THRESHOLD=HIGH

# ElasticSearch/ELK Stack (if using security monitoring)
ELASTIC_PASSWORD=CHANGE_ME_STRONG_ELASTIC_PASSWORD_HERE
ELASTICSEARCH_HOST=elasticsearch:9200
KIBANA_ENCRYPTION_KEY=CHANGE_ME_32_CHAR_KIBANA_KEY_HERE

# External Services
WEBUI_SECRET_KEY=CHANGE_ME_WEBUI_SECRET_KEY_HERE

# Backup Configuration
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_ENCRYPTION_KEY=CHANGE_ME_BACKUP_ENCRYPTION_KEY_HERE
BACKUP_STORAGE_PATH=/opt/mcp-backups

# Network Security
NETWORK_SUBNET=172.21.0.0/16
NETWORK_GATEWAY=172.21.0.1
ALLOWED_NETWORKS=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# Container Security
SECURITY_OPT_NO_NEW_PRIVILEGES=true
SECURITY_OPT_APPARMOR=docker-default
READ_ONLY_ROOT_FILESYSTEM=true
RUN_AS_NON_ROOT=true
USER_ID=1001
GROUP_ID=1001

# Health Check Configuration
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=10s
HEALTH_CHECK_START_PERIOD=30s
HEALTH_CHECK_RETRIES=3

# Performance Tuning
NODE_OPTIONS=--max-old-space-size=512 --no-deprecation --trace-warnings
MALLOC_ARENA_MAX=2
MALLOC_MMAP_THRESHOLD_=131072

# Feature Flags
ENABLE_METRICS=true
ENABLE_TRACING=false
ENABLE_PROFILING=false
ENABLE_DEBUG_ENDPOINTS=false

# Compliance & Audit
AUDIT_LOG_ENABLED=true
AUDIT_LOG_LEVEL=info
COMPLIANCE_MODE=strict
DATA_RETENTION_DAYS=365
GDPR_ENABLED=true

# Alert Configuration
SLACK_SECURITY_WEBHOOK=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
SLACK_SECURITY_CHANNEL=#security-alerts
EMAIL_ALERTS_ENABLED=true
EMAIL_SMTP_HOST=smtp.your-domain.com
EMAIL_SMTP_PORT=587
EMAIL_SMTP_USER=alerts@your-domain.com
EMAIL_SMTP_PASSWORD=CHANGE_ME_SMTP_PASSWORD_HERE

# External Integrations
REGISTRY_AUTH=
CONTAINER_REGISTRY=your-registry.com
IMAGE_PULL_POLICY=Always

# Development/Testing (disable in production)
ENABLE_SWAGGER_UI=false
ENABLE_GRAPHQL_PLAYGROUND=false
ENABLE_DEBUG_ROUTES=false
MOCK_EXTERNAL_SERVICES=false

# =============================================================================
# DEPLOYMENT METADATA
# =============================================================================
DEPLOYMENT_ENVIRONMENT=production
DEPLOYMENT_VERSION=2.0.0
DEPLOYMENT_TIMESTAMP=
DEPLOYMENT_USER=
DEPLOYMENT_COMMIT_SHA=

# =============================================================================
# SECURITY CHECKLIST
# =============================================================================
# [ ] All passwords changed from defaults
# [ ] JWT secrets are cryptographically secure (256-bit minimum)
# [ ] TLS certificates are valid and not self-signed
# [ ] CORS origins are properly configured
# [ ] Resource limits are appropriate for your environment
# [ ] Backup encryption is enabled
# [ ] Security monitoring is configured
# [ ] Network access controls are in place
# [ ] Audit logging is enabled
# [ ] External service credentials are rotated
# =============================================================================